
Linux до огрызка

четверг, 28 июня 2012 г.

TP-Link TL-WR1043ND: Yota, Wi-Fi и VLAN

Исходные данные: беспроводной роутер TP-Link TR-WD1043ND, LTE-модем Yota модели LU150.


Подсоединяем ethernet-кабелем к компьютеру. Выбираем чем шить - моим "самосбором" или прошивкой собранной вручную. Первый - где всё настроено и готово к работе сразу после перепрошивки. Второй вариант позволит вам контролировать все этапы - от сборки до запуска, но придётся немного потрудиться.

1. Сначала первый, как наиболее популярный

1.1. Attitude Adjustment 12.09 (текущая стабильная версия)

Внедрены пакеты:
luci luci-i18n-russian luci-proto-3g luci-theme-bootstrap kmod-usb-net-rndis kmod-usb-storage kmod-usb2 kmod-fs-ext4 kmod-usb-serial kmod-usb-serial-option kmod-usb-serial-wwan kmod-usb-acm usb-modeswitch usb-modeswitch-data kmod-mmc kmod-fs-vfat kmod-fs-msdos block-mount comgt fdisk wireless-tools aircrack-ng reaver luci-proto-ppp openl2tp-mini openvpn-openssl
Эти пакеты позволят иметь рускоязычный красивый (тема Bootstrap вместо скучных обоев) веб-интерфейс, понимать Yota и 3G-модемы (МТС, Билайн, Мегафон и др.), подключать флэшку как дополнительное место для пакетов или как хранилище данных (например для torrent-клиента), изучать Wi-Fi сети на предмет уязвимости в WPS + понимать PPPoE/L2TP/OpenVPN соединения.

В прошивку внедрён конфиг Attitude Adjustment 12.09, обеспечивающий автонастройку всего после перепрошивки.

1.2. Заходим в стандартный веб-интерфейс TP-Link и прошиваем скачанной прошивкой. Аналогично, если там уже стоит DD-WRT или (вдруг) OpenWRT.

1.3. После перепрошивки происходит автоматическая минимальная настройка (благодаря включению их в саму прошивку), в результате которой имеем LAN с адресацией 192.168.1.0/24 и DHCP; Wi-Fi WPA2 сеть с именем linux-core-rulez и таким же паролем, объединена с LAN мостом, поэтому и Yota и машины в LAN будут для неё доступны прозрачно; Yota модем автоматически распознается и будет "расшарен" на LAN и Wi-Fi; пароль на веб-админку и ssh: linux-core-rulez. Если возникнет потребность добавить пакеты - вы это можете сделать самостоятельно, в разделе Система=>Программное обеспечение. С учётом конфигов, там уже прописан адрес http://openwrt.0x90.ru/ (спасибо пользователю Олег Купреев за предоставленный хостинг).


2. Теперь второй способ. Для начала, необходимый минимум:
файл ImageBuilder для платформы ar71xx
Linux/BSD
2.1. Скачиваете файл с ImageBuilder'ом. Распаковываете:
tar xvjf OpenWrt-ImageBuilder-ar71xx_generic-for-linux-x86_64.tar.bz2

2.2. Переходите в появившуюся папку:
cd OpenWrt-ImageBuilder-ar71xx_generic-for-linux-x86_64

2.3. Выполняете в ней команду:
make image PROFILE=TLWR1043 PACKAGES="luci luci-i18n-russian luci-proto-3g luci-theme-bootstrap kmod-usb-net-rndis kmod-usb-storage kmod-usb2 kmod-fs-ext4 kmod-usb-serial kmod-usb-serial-option kmod-usb-serial-wwan kmod-usb-acm usb-modeswitch usb-modeswitch-data kmod-mmc kmod-fs-vfat kmod-fs-msdos block-mount comgt fdisk wireless-tools aircrack-ng reaver luci-proto-ppp openl2tp-mini openvpn-openssl"

Этой командой мы указали для какой модели собирать, а также список дополнительных модулей для включения в собираемую прошивку. Забираете готовую прошивку из каталога bin/ar71xx. Нужная будет называться openwrt-ar71xx-generic-tl-wr1043nd-v1-squashfs-factory.bin

2.4. Если хочется сделать прошивку с заранее выбранными настройками, то

2.4.1 Получим архив настроек. Можно сделать самому, если уже стоит OpenWRT и настроен как нужно - Система => Резервная копия / Прошивка => Создать архив. Если же OpenWRT пока нет - можно взять из п. 1.1 (в данном случае это Snapshot (37737).

2.4.2. Полученный архив распаковываем (пусть это будет в папке /tmp/openwrt-config), заходим снова в папку OpenWrt-ImageBuilder-ar71xx_generic-for-linux-x86_64 и выполняем команду, аналогичную в п.2.3, только с небольшим довеском:
make image PROFILE=TLWR1043 PACKAGES="luci luci-i18n-russian luci-proto-3g luci-theme-bootstrap  kmod-usb-net-rndis kmod-usb-storage kmod-usb2 kmod-fs-ext4 kmod-usb-serial kmod-usb-serial-option kmod-usb-serial-wwan kmod-usb-acm usb-modeswitch usb-modeswitch-data kmod-mmc kmod-fs-vfat kmod-fs-msdos block-mount comgt fdisk wireless-tools aircrack-ng reaver" FILES="/tmp/openwrt-config"



3. Удивительно, но на этом роутере можно поднять VLAN'ы и пускать каждый интерфейс по своему. Удобно когда все эти сети нужно разруливать где-то ещё, акромя самого TP-Link. Рассмотрим вариант, когда с роутера получаем по Ethernet 4 канала (через VLAN-теги на пакетах). Сеть ёты получаем 10-м вланом, Wi-Fi сеть получать 11-м, сеть с WAN-портом - 12-м, а управляющий - VLAN с ID=2.
3.1. Предполагается, что 1-й порт будет для шлюза и там будут только тэгированные VLAN'ы. Порты 2-4 - на случай экстренного доступа "покачать". Откройте раздел "Network/Switch". Список VLAN-ов должен выглядеть примерно так:

2, off, tagged, off, off, off, tagged
10, off, tagged, untagged, untagged, untagged, tagged
11, off, tagged, off, off, off, off, tagged
12, untagged, off, off, off, off, tagged

3.1. В настройках интерфейса LAN поставим мост между eth0.10 и eth1. Ёта готова =)

3.2. Настроим нужный адрес на новом интерфейсе "Management", созданного в "Network/Interfaces" над интерфейсом eth0.12. Именно по этому (!единственному) адресу можно будет работать с настройкой точки. У остальных интерфейсов должно стоять "Unmanaged".

3.3. Создадим интерфейс в разделе "Network/Interfaces" с именем WIFI. Протокол укажем "Unmanaged". Сделаем его мостом над интерфейсами eth0.11 и "Wireless Network:". Теперь роутер готов отдавать Wi-Fi-трафик через 11-й влан.

3.3.1 Запустим беспроводной адаптер - откройте "Network/Wifi". Настраиваете как нужно (название сети, канал и т.п). Главное, в разделе "Network" сделать привязку к интерфейсу "wifi". Применяем и возвращаемся на страницу "Network/Wifi", жмём "Enable" чтобы окончательно включить адаптер.

3.4. На стороне сервера это выглядит так: vlan10: 10.0.0.x/24, gtw: 10.0.0.1, dns:10.0.0.1; vlan11 - любой используемый, т.к. сеть Wi-Fi независима.


TIP: чтобы сбросить настройки OpenWRT до исходных (например забыли пароль на админку) - надо при включении роутера, дождаться как начнёт мигать SYS-лампочка и нажать кнопку OSS. SYS-лампочка станет чаще мигать. Зайти telnet на адрес 192.168.1.1 (он всегда такой в этом режиме восстановления) и ввести команду:
mtd -r erase rootfs_data
TIP2: если обновили прошивку, а /overlay был на флэшке, то скорее всего она не примонтируется. Для этого надо загрузиться без флэшки, воткнуть флэшку и выполнить в консоли:
mount /dev/sda1 /mnt/sda1
cp /.extroot.md5sum /mnt/sda1/etc/extroot.md5sum

UPD: Нашел неплохое руководство на русском как собирать свой образ прошивки, как внедрить свой пакет в OpenWRT.
Автор: toogen на 4:38 
Отправить по электронной почте
Написать об этом в блоге
Опубликовать в Twitter
Опубликовать в Facebook
Поделиться в Pinterest

86 комментариев:

B1rdEX10 сентября 2012 г., 19:51
Привет. Отличная статья, всё заработало.
Делал простой вариант, без VLAN.

Не получается пробросить порт извне. Сегодня получили статику — втыкаешь модем в ноут — всё работает извне.
Втыкаешь в модем — фиг.
В порт-форвардинге уже как только не писал правила… Есть мысли?

Ответить
Ответы

B1rdEX10 сентября 2012 г., 20:05
Ура, решилось… не знаю, что конкретно помогло, но сделал следующее:
1) добавил форвардинг: IPv4-TCP any host in wan any router IP at port 80 > 192.168.1.254 80 in lan
2) убрал бридж и оставил для ван eth1
3) поменял static на dhcp в настройках вана

Магия, но заработало :)

Ответить

toogen11 сентября 2012 г., 15:56
Рад что помог =) Там в разделе с настройками фаервола (под Luci-интерфейсом) есть целый раздел именно для проброски (forwarding) портов. Мост нужен только если юзать фичу VLAN-тэгирования, иначе можно смело сносить. Насчёт DHCP для Yota-интерфейса - хез почему, но что под линухами, что под openwrt - ёта критует при DHCP-запросе (т.е. перезапускается). Да и как правило, там даётся IP из диапазона 10.0.0.2-10.0.0.254 с одинаковыми настройками шлюза и DNS (10.0.0.1). Но у вас уже статика (т.е. внешний IP) и там другие настройки (можно скопировать с настроек под Windows). Не понял только зачем DHCP при статике =)

Ответить
Ответы

B1rdEX12 сентября 2012 г., 5:14
Оно-то вроде бы всё так с этим DHCP и внешняя статика не влияет — всё так же 10.0.0.0-254/10.0.0.1.
Сейчас выключил DHCP — порты извне перестали отвечать. Magic?

Ответить

B1rdEX2 октября 2012 г., 9:17
Сегодня шил очередной роутер — спасибо за upd2 — сервер downloads.openwrt.org на любой запрос выдаёт 404.
Прошился без проблем, всё работает. Единственное, непривычно после 10 предыдущих роутеров смотреть на русскоязычный интерфейс :)

Ответить

habi2al9 января 2013 г., 15:20
у меня вопросий - при прошивке согласно пункту 1.1 при изменении пороля в вебинторфейсе поменяется ли пороль для ссш или отдельно надо куда то залезать и менять?

Ответить

toogen9 января 2013 г., 21:39
поменяется, там единая база паролей /etc/passwd

Ответить
Ответы

habi2al10 января 2013 г., 17:38
вобщем большое спасибо! скачал файл из пункта 1.1, обновил девайс (была прошивка 120405 boot).

после перезагрузки всё заработало сразу и железно. поменял только ид и ключ вайфая, ид устройства и пароль вместо линухкорерулез

воткнул лу150 - попёр инторнет. единсветнное но - my.yota . ru не доступна была, пришлось в настройках менять днс на 8.8.8.8 и 8.8.4.4

зато йотовская Приблуда, что в трее висит, распознаёт каким то образом что через момед йотовский инторнет - показывается синенькой и даёт посмотреть статистику.

вобщем выражаю глубокую признательность и восхищение профессионализмом!

Ответить

B1rdEX10 января 2013 г., 18:26
> зато йотовская Приблуда, что в трее висит, распознаёт каким то образом что через момед йотовский инторнет - показывается синенькой и даёт посмотреть статистику

она тупо в 10.0.0.1 долбится…

Ответить

fragg16 января 2013 г., 20:36
Помогите у меня вообще не выходит модем Е392 мегавонь... не хочет конектиться а ссылка на готовую прошу умерла(

Ответить
Ответы

toogen19 января 2013 г., 4:50
Обновил прошивку и ссылку в 1.1
Е392 отлично работает в OpenWRT как UMTS/GSM модем (единственно лимит по входящей скорости в 20Мбит). Дата порт там /dev/ttyUSB1, APN - internet, всё остальное дефолтное. Добавляете новый интерфейс и выбираете Протокол нового интерфейса - UMTS/GPRS/EV-DO


fragg23 января 2013 г., 14:41
А как можно убрать этот лимит в 20 Мбит, если возможно вообще?


fragg23 января 2013 г., 14:43
Да и спасибо за ответ!)


fragg23 января 2013 г., 20:55
Теперь проблема с вафлей на ноуте, постоянно отваливается...

Ответить

toogen25 января 2013 г., 1:13
Пока не особо, rndis-драйвера для E392 ещё нет. Насколько я знаю, для Мегафона это неактуально, ибо надо постараться чтобы найти БС с пропускной способностью в 70 Мбит/c (как обещают по максимуму), т.к. обычно это 10 Мбит/c.

Ответить

habi2al7 февраля 2013 г., 21:20
добрый день.
вопросий по прокидивынию портов, как?

скачал и установил сабжевый п.1

Ответить
Ответы

habi2al7 февраля 2013 г., 21:40
упрощаю вопросий. скачал средстваме вебморды пакет miniupnpd (вроде так)

что - лезть через ссш и там в конфиге что то сделать?

что например? мне вот допустим пробросить порт для айпи 192.168.1.100 (я его по макадресу навечно присвоил)


toogen8 февраля 2013 г., 10:27
Примерно вот так:
[img=http://s017.radikal.ru/i431/1302/89/cc2c5856fb32.png][/img]
Сеть -> Межсетевой экран -> Перенаправление портов

Ответить

habi2al13 февраля 2013 г., 16:32
мне тут наконец кинули оптоволокно. нужда в йоте отпала, откатывать прошивку на заводскую тоже не хочется.

что нужно сделать, чтобы настроить pppoe в этой прошивке? установить модуль ppp-mod-pppoe вроде

а конфигурация - в вебморде можно конфигурировать pppoe?

Ответить
Ответы

toogen13 февраля 2013 г., 17:21
Достаточно поставить luci-proto-ppp, он подтянет всё что нужно.
На оптике (FTTB) обычно идут 2 интерфейса - первоначальный, на котором через DHCP получается адрес, и второй - PPPoE/L2TP/PPP через который уже дают интернет. Если нужен только интернет, то WAN с DHCP можно убрать (для PPPoE не обязательно наличие IP-адреса).

Примерно вот так - http://s001.radikal.ru/i195/1302/a4/662d4dd32f75.png


habi2al13 февраля 2013 г., 18:02
не, я ещё не видел, мне по телефону сказали, что из их адаптера пойдёт эзернет кабель, который можно воткнуть в компьютер или роутер. в компе или роутере надо настроить pppoe


toogen13 февраля 2013 г., 18:38
Да) так и есть) я имел в виду что там как правило двойное подключение - первый по DHCP, потом второй по PPPoE/L2TP. На первом обычно висит IPTV и локальные ресурсы провайдера, на втором - интернет.


habi2al9 марта 2013 г., 23:17
чорт, нет доступа к внутренней сетке.
у чуваков сайт статистики, что то типа stat.провайдер.ru, доступен только изнутри.
подключаю роутер к ихней сетке - всё работает, кроме доступа к этому сайту (его имя даже не резолвится средствами диагностики внутри роутера)
подключаю комп напрямую к их сетке - всё резолвится. там чисто pppoe по дефолту майкрософтский

что делать, куда хотя бы смотреть?


toogen10 марта 2013 г., 2:21
По-идее, должен прокатить вариант с 2 соединенями в WAN-зоне - DHCP-client и PPPoE. Первое получит внутренние DNS (возможно ещё и шлюзы на какие-нибудь локальные ресурсы в другой подсети), второе поднимет интернет (внешние DNS и шлюзы собственно в интернет).

Ответить

boh burg20 февраля 2013 г., 19:46
Можно ли выложить ещё раз файл из п.1.1?

Ответить
Ответы

B1rdEX20 февраля 2013 г., 22:11
Вот одна из версий, устанавливал на пару устройств https://www.dropbox.com/s/ecn35d2ohyozo1n/tp-link%20tl-wr1043nd-yota-ready.bin


toogen21 февраля 2013 г., 1:57
Обновил ссылку, новый транк + внедрил L2TP/PPPoE


boh burg21 февраля 2013 г., 21:52
Спасибо большое!

Ответить

Анонимный28 февраля 2013 г., 12:37
Попробовал, но L2TP не поднимается на последней прошивке через веб-интерфейс.

Ответить

Focusnick19 марта 2013 г., 10:43
Tooget, выложили файл прошивки последней вести еще раз. По текущей ссылке пишет что файл был удален.
Заранее благодарен.

Ответить
Ответы

toogen19 марта 2013 г., 16:26
Обновил прошу и выложил, теперь на Яндекс.Диск. По-идее, удалить не должны =)
Насчёт L2TP - я настраивал его 1 раз (Билайн), долго сношался, да =) Но настроил и оно работало. Там смысл в том что надо поднимать 2 соединения на WAN-интерфейсе - простой DHCP и Openl2tp. Причём работало прямо из веб-интерфейса, без шаманств описанных в http://homenet.beeline.ru/index.php?showtopic=290284 (может эта ссылка поможет кому-нибудь).

Ответить

Focusnick20 марта 2013 г., 14:42
Спасибо! Все прекрасно слилось. В ближайшее время буду пробовать. Кстати с l2tp попробую поковыряться ибо появилась необходимость.

Ответить
Ответы

кужелев владислав23 апреля 2013 г., 1:06
Огромное спасибо за прошивку, yota завелась сразу, завтра попробую L2tp. Теперь вопрос: хотел поставить openvpn как описано на ttp://limga.livejournal.com/528.html но в репозитарии нет этого пакета. Какой адрес репозитария можно добавить чтобы в нем был этот пакет или где можно скачать этот пакет и как его потом засунуть в роутер?. P.S. l2tp настраивал на другом роутере по http://forum.ru-board.com/topic.cgi?forum=81&topic=6412&start=5&limit=1&m=1 заработало все как часики. ньюанс -адрес сервера билайна tp.internet.beeline.ru для краснодара


кужелев владислав23 апреля 2013 г., 2:01
подсунул вот этот адрес http://downloads.openwrt.org/attitude_adjustment/12.09-beta/ar71xx/generic/packages/ пакет ставлю и получаю.root@linux-core-rulez:~# opkg install openvpn --force-depends
Installing openvpn (2.2.2-2) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-beta/ar71xx/g eneric/packages//openvpn_2.2.2-2_ar71xx.ipk.
Installing kmod-tun (3.3.8-1) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-beta/ar71xx/g eneric/packages//kmod-tun_3.3.8-1_ar71xx.ipk.
Installing liblzo (2.06-1) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-beta/ar71xx/g eneric/packages//liblzo_2.06-1_ar71xx.ipk.
Configuring kmod-tun.
//usr/lib/opkg/info/kmod-tun.postinst: .: line 3: can't open '/etc/functions.sh'
Configuring liblzo.
Configuring openvpn.
Collected errors:
* satisfy_dependencies_for: Cannot satisfy the following dependencies for openv pn:
* kernel (= 3.3.8-1-6c06ba2494c9c458b747d6a40b2cc970) *
* pkg_run_script: package "kmod-tun" postinst script returned status 2.
* opkg_configure: kmod-tun.postinst returned 2.
как я понял этот пакет для другого ядра. что делать дальше, помогите пожалуйста.


toogen23 апреля 2013 г., 3:06
Логично =) Моя прошивка собиралась из транковой версии, а вы указываете на пакеты из стабильной (не самой последней кстати). Тут 2 выхода - я могу создать прошивку на основе Attitude_adjustment 12.09-rc2 (это последняя из стабильных) и тогда любой сможет ставить пакеты из http://downloads.openwrt.org/attitude_adjustment/12.09-rc2/ar71xx/generic/packages/ , либо, я могу собрать последнюю транковую с внедрённым openvpn. Даже не знаю как лучше =)


toogen23 апреля 2013 г., 3:56
Сделал оба варианта =) Собственно первый - прошивка версии Attitud Adjustment 12.09rc2 с пакетами из п.1.1 (вместо openvpn-openssl там просто openvpn - просто так он в этой версии называется) - http://yadi.sk/d/_Na1CwDu4Gj_p

А второй - в п.1.1 (заодно обновил прошивку)


кужелев владислав24 апреля 2013 г., 0:47
Установил прошивку версии Attitud Adjustment 12.09rc2. openvpn сервер запустился судя по логу,подключил beelinl2tp, повторюсь, настраивал по http://forum.ru-board.com/topic.cgi?forum=81&topic=6412&start=5&limit=1&m=1 , зарегился на dundns как описано на http://interface31.ru/tech_it/2012/05/adminu-na-zametku-vypusk-5-kak-ispol-zovat-dyndns-besplatno.html потом поставил пакет opkg install luci-app-ddns,перезагрузил, затем настроил службу dyndns(находится в вебинтерфейсе во вкладке сервисы) по скриншоту на http://autohome.org.ua/12-openwrt/23-dyndns-openwrt-for-wifi, выключаю комп или выхожу на нем из аккаунда dyndns, перезагружаю роутер и мой динамический ip привязан к хосту. Завтра буду настраивать openvpn клиента. Подозреваю засаду с пробросом портов и тому подобным. О результатах отпишусь.
P.S. огромное вам спасибо за оперативный ответ и новые прошивки!
P.P.S Может поднимете настройку l2tp и dyndns в основную статью? На авторство я абсолютно не претендую,все честно скопипиз*ено с других сайтов.


кужелев владислав24 апреля 2013 г., 1:23
Вообще весь этот геморой с vpn нужен мне только из-за того, что дома где часто отсутствую, интернет только Yota (серый ip),я хочу поставить удаленное видеонаблюдение через openvpn клиента. У сестры интернет beeline, l2tp с динамическим ip, там поставил роутер с openvpn сервером. Линукс и английский к сожалению знаю на 3 с минусом,поэтому буду благодарен за любую помощь в настройке описанной схемы. Готов отблагодарить рублем (или ремонтом и консультацией по бытовым холодильникам, сплитам и хол. оборудованию :)).


toogen24 апреля 2013 г., 2:50
Эммм, я в статью включаю только то что лично делал =) L2TP билайна настраивал 1 раз и больше возможности для экспериментов пока нет. Есть опыт по созданию бесплатного хотспота Wi-Fi с туннелированием через Tor - чтобы дать всем соседям доступ в инет и не думать что они там плохого делают =)

Кстати, касаемо DynDNS - зачем? Есть куча аналогичных сервисов абсолютно бесплатно:
http://freedns.afraid.org/
http://www.dnsdynamic.org/
http://www.zonomi.com/
Они все поддерживают стандартный Dynamic DNS API, т.е. совместимы с luci-app-ddns

Касаемо OpenVPN - использовал тоже давно и как-то был разочарован соотношением сношений/результат и остановился на проброске портов к компьютеру за NAT'ом (а в случае Yota - даже за двойным NAT) через SSH. Со стороны роутера за ётой и камерой (допустим у неё адрес 192.168.66.1) делаем клиентское подключение к роутеру билайна с внешним динамическим IP по DDNS-имени (допустим vasya.superdynamicdns.org), на котором в туже внешку слушает SSH-сервер по порту 12345. Внутренний IP-адрес роутера за билайном пусть будет 192.168.77.1. Порт для доступа к вебкамере со стороны роутера за ётой допустим 80-й, порт для доступа к той же вебкамере, но со стороны роутера с билайном - пусть будет 8081. Тогда на роутера за ётой достаточно поддерживать в рабочем состоянии следующую команду:
ssh -R 192.168.66.1:80:192.168.77.1:8081 user@vasya.superdynamicdns.org -p 12345

Находясь за роутером в билайне (т.е. в сети 192.168.77.x) тогда достаточно будет с любого хоста в ней получить доступ к камере по адресу http;//192.168.77.1:8081 (или иному протоколу, если у камеры нет веб-интерфейса). Сгенерить пару ключей (чтобы оба роутера связывались без паролей по сертификату). Весь трафик будет шифрован стандартными средствами OpenSSH/Dropbear. Логично, что порт 12345 должен быть открыт во внешку на роутере за билайном.

ХЗ, имхо это проще для задачи тупо пробросить 1 порт между двумя сетями. OpenVPN нужен когда требуется полный доступ между обоими сетями.


кужелев владислав24 апреля 2013 г., 8:09
А как подключится к устройству за yota с мобильного интернета? (например планшет андроид и симка МТС. я тогда должен сперва кинуть порт по ssh до билайна? Топология сетки получится звезда(не очень хорошо, низкая надежность). При openvpn только идентификация через сервер а дальше клиенты общаются напрямую.Еще конечно хочется и полный доступ между несколькими сетями (дом(за роутером комп, сетевой диск, ip камеры,и мечтаю о охранно-пожарной сигнализации) , сестра(за роутером комп, камеры и ОПС (в мечтах)), мать (за роутером комп, камеры и ОПС магазина в деревне(в мечтах)) с последующим расширением сетей. Наверно только openvpn остается или есть что-то другое, проще?


toogen24 апреля 2013 г., 9:38
Чёт я не уверен, про "идентификация через сервер а дальше клиенты общаются напрямую". Мабыть тады проще взять самый сявский хостинг (2-3к руб в год), поднять там openvpn + без заморочек на динамику.


кужелев владислав24 апреля 2013 г., 14:15
Да, Вы правы, а я перепутал кислое с горячим. Почитал внимательно и заплакал "По умолчанию, когда клиент OpenVPN активен, только сетевой трафик к и от сайта OpenVPN-сервера идет через VPN. Например, обычный просмотр веб-страниц будет осуществляться через прямое подключение (к Интернету -- прим. перев.) в обход VPN." т.е. топология звезда.Можно поподробней про "Мабыть тады проще взять самый сявский хостинг (2-3к руб в год), поднять там openvpn" или ткните где почитать.


кужелев владислав24 апреля 2013 г., 17:48
Как я понял есть еще OSPF но там вообще темный лес. Кстати у матери тоже динамический ip (можно сделать статический но подключение там через ADSL, скорость до 5 Мбит и провайдер полное г-но плюс бываю там там не чаще 1 раз в неделю) , может там поднять сервер №2 openvpn (аварийный)и тогда получится довольно надежно,но проблемно в настройках.


toogen3 мая 2013 г., 12:08
Насчёт хостинга - любой XEN/KVM (HyperV или VMWare стоят подороже) с мощностями не более 256Mb RAM / 400MHz CPU / 4 GB. Ставишь свой любимый дистрибутив и поднимаешь OpenVPN. Ну и завязываешь все свои устройства на этот сервер. Постоянный внешний IP + гарантия что сервер не упадёт если дома отключат свет =)

Например, здесь можно прикинуть расценки: http://www.truevds.ru/price

Ответить

Анонимный3 апреля 2013 г., 18:27
Спасибо большое, все просто супер.

Ответить

Focusnick28 мая 2013 г., 13:01
Скажите, откуда можно скачать и как установить пакеты wshaper и qos? Очень нужны, а в репозитории для текущей версии и сборки их нет. Эти пакеты были установлены еще на старой версии прошивки, потом я при перенастройке сделал не так и пришлось делать сброс. 
Соответственно все слетело.
Заранее спасибо!

Ответить
Ответы

toogen28 мая 2013 г., 18:27
Можно взять прошивку отсюда http://yadi.sk/d/_Na1CwDu4Gj_p
Она стабильной версии Attitude Adjustment 12.09rc2 с пакетами из п.1.1 и замечательно подхватывает пакеты из официального репозитария http://downloads.openwrt.org/attitude_adjustment/12.09-rc2/ar71xx/generic/packages/ где есть и wshaper и qos

У транковых прошивок есть недостаток - ВСЕ пакеты для них собираются под новую версию и, как правило, несовместимы с предыдущей. Как выход - скачивать полностью и хранить на флэшке воткнутой в роутер =)

Ответить

Focusnick31 мая 2013 г., 12:38
Спасибо огромное! )
Я так понимаю понижение версии прошивки не превратит мой роутера в кирпич?

Ответить
Ответы

toogen31 мая 2013 г., 14:56
Нет. Там кирпич случается только при смене типа загрузчика. OpenWRT - это вам не говнокод от производителей)

Ответить

Vladislav Kuzelev8 августа 2013 г., 7:46
Доброго времени суток. Выплыла проблема на стабильной версии прошивки. 1. В настройках wi-fi два интерфейса (для 2.5 гц и 5 гц.). Не подключается в качестве клиента к wi-fi сети 2.5гц. На транке все работает, но не ставится пакет kmod-video-uvc а так хотелось использовать роутер +usb камеру c270 с качестве wi-fi камеры. Можно как-то решить эту проблему?

Ответить
Ответы

toogen8 августа 2013 г., 15:56
Оу. Сэнкс за замеченный косяг =) Добавил в статью новые сборки для 12.09 и текущий snapshot. В обоих пофиксен баг с wi-fi, т.к. в новых openwrt они начали делать привязку по mac-адресу адаптера. Я сменил это на привязку к имени устройства, т.е. заменил параметр option macaddr на option phy

Также в обе прошивки теперь прописаны репозитарии на стороннем хостинге и можно не бояться, что перестанет доступен downloads.openwrt.org. Также это позволит использовать текущий snapshot не опасаясь выхода более новой версии, при которой становится невозможным ставить пакеты от предыдущей.

Также в статью добавил ссылки на конфиги для тех кто хочет собрать сам (или проверить мою честность, хехехе =)

Ответить

Vladislav Kuzelev9 августа 2013 г., 21:14
К сожалению и на обновленной стабильной версии прошивки роутер не подключается в качестве клиента к wi-fi сети. На транке все работает ,usb камеру запустил. Получилась wi-fi веб камера с разрешением 1280*720 и частотой 15 кадров/сек. Огромное Вам спасибо!

Ответить
Ответы

toogen9 августа 2013 г., 22:18
Хм. Прошивки реально по конфигу отличаются только значением в /etc/opkg.conf. Видать косяк в wifi или у вас точка доступа с каким-то хитрым доступом. Я у себя максимум использую wifi в 1043 только как точку доступа и проблем нет.

В любом случае можно смело работать на транке, себе тоже поставил полёт стабильный =)

Ответить

Vladislav Kuzelev9 августа 2013 г., 23:08
точка доступа роутер tp link wdr-3500 прошитый Openwrt, правда транковой. Может в этом косяк? Шифрование wpa2-psk. Идентификация tkip-aes.

Ответить
Ответы

toogen10 августа 2013 г., 2:17
возможно) если будет вариант - прошейте 3500 тоже на 12.09
можно ещё поиграться с типом шифрования...

Ответить

Valiyan Gimranov23 сентября 2013 г., 20:47
Прошил стабильной прошивкой, не могу выйти в интернет на yoty, подключен yota модем, выше указанно что нужно поменять dns на Гусловские, не нахожу, в какие пункты прописывать. К своему стыду в Линуксе профан. Как исправить? Спасибо.

Ответить
Ответы

toogen23 сентября 2013 г., 23:53
На странице Сеть, Интерфейсы - там должен быть интерфейс (сеть) Yota. У неё есть вообще IP-адрес?


Valiyan Gimranov24 сентября 2013 г., 15:31
да, есть. попробовал прописать ip 8.8.8.8 и 4.4.4.4, не соединяется

Ответить

Valiyan Gimranov26 сентября 2013 г., 20:47
Разобрался, надо прописывать DNS на конечных пользователях, в свойствах сетевого соединения. Спасибо за разработку!

Ответить
Ответы

toogen27 сентября 2013 г., 1:53
рад, что заработало, однако у меня вполне работает через DNS самого роутера (т.е. у клиента DNS-сервером прописан IP-адрес роутера)

Ответить

Valiyan Gimranov27 сентября 2013 г., 22:00
Не пробовал прописывать dns роутера, просто привык, если работает DHCP, то получает автоматически, но пока устраивает, всё заработало, теперь на таком же роутере дома хочу поставить данную прошивку, необходим доступ извне к компьютеру по RDP, оплачиваю выделенный IP, а на стандартных прошивках доступ не проходит. Уже потратил много времени, а эффекта ноль. Как нужно прописывать доступ на Вашей прошивке? Интересует какой-либо нестандартный порт, и в дальнейшем буду пытаться повесить на домашнем компьютере web-сервер, с открытым доступом извне.

Ответить
Ответы

toogen27 сентября 2013 г., 23:08
Ну я это и имел в виду - DNS из настроек DHCP.

На том, домашнем роутере у вас тоже ёта? Просто у них с прокидыванием портов туго. Хотя, если есть статика - то должно прокатить.
Собственно, на прошивке OpenWRT порты пробрасываются очень просто - Сеть, Межсетевой экран, Перенаправление портов. Там в принципе всё ясно и понятно =)

Ответить

Valiyan Gimranov28 сентября 2013 г., 23:11
нет, на домашнем как раз хороший нет, по кабелю, до 100мб. на стандарте- порты не прокидывает, вот и думаю прошить эту прошивку.

Ответить

Валек Мирошниченко11 ноября 2013 г., 19:47
Привет !!! Есть проблемка ! С монтированием флешки в root /overlay - суть монтирования - когда я применяю данные изменения то всё завистает на сохранении кофига в /etc/config/fstab ,после перезагрузки ничего не меняется. В случае ручного изменения и сохраненя конфига "fstabi" флеша примонтируеться после ребута но но есть проблема - при настройке соединения PPPoE интернета нету ни по лану ни по wifi, но на инфо странице трафик бегает ! Что можно сделать и в чём может быть проблема ???

Ответить
Ответы

toogen12 ноября 2013 г., 2:18
Вы используете стабильную или транковую прошивку? На транковых сейчас проблемы с внешним оверлеем - там надо по-особому подключать. Я убрал со страницы транковую, так как с ней у народа проблемы. Попробуйте поставить стабильную 12.09 - там флэшку можно спокойно подключать как хранилище для /overlay


Валек Мирошниченко12 ноября 2013 г., 23:28
Я установил именно OpenWrt Attitude Adjustment 12.09 / LuCI 0.11.1 Release (0.11.1) - и вот такая проблема, и почему пропадает инет хотя трафик видно что бегает, я уже думал что флеш криво форматнул или своп раздел не зделал но я уже не знаю чего делать ! Помогите )!)!


toogen13 ноября 2013 г., 0:38
1) Зачем вам флэшка? Не хватает места под пакеты?
2) Как вы настраиваете PPPoE?
3) Как вы переносите оверлей на флэшку? Надеюсь по этому руководству http://wiki.openwrt.org/doc/howto/extroot#openwrt.12.09.attitude.adjustment ?

Я могу собрать вам чистую прошивку (без внедрённых конфигов) 12.09. Возможно это поможет вам, т.к. здесь уже преднастроенная и рассчитана на использование LTE LU150.


Валек Мирошниченко13 ноября 2013 г., 1:48
Этот комментарий был удален автором.


Валек Мирошниченко14 ноября 2013 г., 1:23
Соборите мне пожалуйста чистую прошу с веб интерфейсом PPPoE. Заранее спсибо.


toogen14 ноября 2013 г., 5:10
http://zalil.ru/34811557
это чистый 12.09 с пакетами luci luci-i18n-russian luci-proto-3g luci-theme-bootstrap kmod-usb-net-rndis kmod-usb-storage kmod-usb2 kmod-fs-ext4 kmod-usb-serial kmod-usb-serial-option kmod-usb-serial-wwan kmod-usb-acm usb-modeswitch usb-modeswitch-data kmod-mmc kmod-fs-vfat kmod-fs-msdos block-mount comgt fdisk luci-proto-ppp openl2tp-mini openvpn


Валек Мирошниченко24 ноября 2013 г., 14:48
Спасибо, всё работает ! Н маршрутник по непонятной причине начал самопроизвольно перезагружаться каждые 40 мин., что можно сделать ?


toogen24 ноября 2013 г., 18:23
В душе не чаю что за беда) Он у меня ребутится тоже. но раз в неделю максимум. Может перегрев, может модуль какой падает - щупать корпус (или разобрать совсем), читать логи системы. На крайний случай вернуть заводскую прошивку - потребности у вас невысокие, с PPPoE она справится "враз".

Ответить

Анонимный27 ноября 2013 г., 9:16
А как можно перезалить прошивку в роутере, не могу никак в веб интерфейс выйти, через lan yota работает, через wifi не хочет.

Ответить

Анонимный27 ноября 2013 г., 12:34
Все наконец сбросил настройки. Кому интересно проблема заключалась в том что через телнет не мог подключиться к маршрутизатору выдавало ошибку, помогло после того как прописал порт на сетевой карте 192.168.1.хлюбой отличный от 1]

Ответить

fragg9 декабря 2013 г., 11:22
Прошу помощи, в связи с зарезанием трафика на торрентах и мультемедийных yotoй ресурсов возникла потребность к подключению роутера к серверу Open VPN или PPPoE для обхода ограничения, возможно ли настроить на одном роутере TP link 1043ND

Ответить
Ответы

toogen9 декабря 2013 г., 11:55
http://wiki.openwrt.org/inbox/vpn.howto
создаётся интерфейс и назначается сеть


fragg9 декабря 2013 г., 19:06
Этот комментарий был удален автором.

Ответить

fragg10 декабря 2013 г., 9:39
Этот комментарий был удален автором.

Ответить

fragg10 декабря 2013 г., 17:57
Поднял соединение PPTP а как через него интернет пустить?

Ответить

Дмитрий Владимиров18 января 2014 г., 13:55
Слава богам интернета!!!
Всё встало легко и ненапряжно...
Единственно, после закачки прошивки пришлось питалово роутера переткнуть, ибо штатной перезагрузкой не стартовал.

Ответить

Анонимный25 января 2014 г., 16:39
не работает IPTV ... что где включить нужно ?

Ответить

habi2al30 января 2014 г., 23:36
Приветствую, togen!

вопрос - началась какая то лажа недавно - херятся и подвисают запросы, что аштитипи, что фтп. както суко странно, такое впечатление, что запросы начал фильтровать. вот например - бекаплю сайт один раз в сутки. так там это - одни и те же файлы не могу скачать, мистика какая то. хостеры ничего понять суко не могут. или вот ролики в ютубе. далеко не все балин того, показывает. просто если фидлером смотреть - херня, до половины респонс от сервера получен, и обрыв. или вот ща с компьютерры ру - картинки две на странице показались, а одна - ни в какую, я её отдельно открыл, фидлер показал, что получен заголовок респонса, а боди - нету.

что за нах? куды смотреть? выключил его ща и переключился напрямую - всё летаит. подключался через него и по вайфаю, и по езернету - одна хрень.

прошивка эта вот. куды смотреть, что делать?

Ответить
Ответы

toogen31 января 2014 г., 21:12
Модем LU150? Если нет - то эта прошивка не потянет. Ещё как вариант - уменьшить MTU на интерфейсе (eth1 где ёта). Ну и глянуть Статус -> Журнал ядра, там могут ошибки тоже сыпаться.

Ответить

Aureole1081 февраля 2014 г., 15:05
Подскажите пожалуйста как и где прописать логин и пароль для 3G модема. Возможно ли использовать с ней другие модемы (не встречающиеся в России)?

Ответить
Ответы

toogen2 февраля 2014 г., 14:02
Там нужно создать новый интерфейс с протоколом "UMTS/GPRS/EV-DO" и у него в настройках будет что-то подобное http://s019.radikal.ru/i610/1402/ab/a3dc08678ec5.png

Ответить

Анонимный3 мая 2014 г., 11:40
Вопрос у меня 1043 v2,пишетто прошика не подходит((что делать?

Ответить

Ещё
Следующее Предыдущее Главная страница
Подписаться на: Комментарии к сообщению (Atom)
Архив блога

Октябрь 2012 (2)
Сентябрь 2012 (1)
Июнь 2012 (1)
Апрель 2012 (2)
Шаблон "Simple". Технологии Blogger.

